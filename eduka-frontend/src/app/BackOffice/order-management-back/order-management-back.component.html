<div class="container-fluid mt-4">
  <!-- Statistics Cards -->
  <div class="row mb-4">
    <div class="col-md-3">
      <div class="stat-card bg-primary text-white">
        <div class="stat-icon"><i class="bi bi-receipt"></i></div>
        <div class="stat-content">
          <h3>{{ totalOrders }}</h3>
          <p>Total Orders</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card bg-success text-white">
        <div class="stat-icon"><i class="bi bi-currency-dollar"></i></div>
        <div class="stat-content">
          <h3>${{ totalRevenue.toFixed(2) }}</h3>
          <p>Total Revenue</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card bg-warning text-white">
        <div class="stat-icon"><i class="bi bi-hourglass-split"></i></div>
        <div class="stat-content">
          <h3>{{ pendingOrders }}</h3>
          <p>Pending Orders</p>
        </div>
      </div>
    </div>
    <div class="col-md-3">
      <div class="stat-card bg-info text-white">
        <div class="stat-icon"><i class="bi bi-check-circle"></i></div>
        <div class="stat-content">
          <h3>{{ completedOrders }}</h3>
          <p>Completed Orders</p>
        </div>
      </div>
    </div>
  </div>

  <!-- Orders Management Card -->
  <div class="card">
    <div class="card-header bg-primary text-white">
      <h3 class="mb-0">
        <i class="bi bi-list-ul"></i> Order Management
      </h3>
    </div>
    <div class="card-body">
      <!-- Filters Section -->
      <div class="row mb-3">
        <div class="col-md-3">
          <div class="input-group">
            <span class="input-group-text"><i class="bi bi-search"></i></span>
            <input
              type="text"
              class="form-control"
              placeholder="Search by Order/User ID..."
              [(ngModel)]="searchTerm"
              (keyup)="filterOrders()"
            />
          </div>
        </div>
        <div class="col-md-3">
          <select
            class="form-select"
            [(ngModel)]="filterStatus"
            (change)="filterOrders()"
          >
            <option value="">All Statuses</option>
            <option *ngFor="let status of orderStatuses" [value]="status">
              {{ status }}
            </option>
          </select>
        </div>
        <div class="col-md-3">
          <select
            class="form-select"
            [(ngModel)]="filterRestaurantId"
            (change)="filterOrders()"
          >
            <option [ngValue]="null">All Restaurants</option>
            <option *ngFor="let restaurant of restaurants" [value]="restaurant.id">
              {{ restaurant.name }}
            </option>
          </select>
        </div>
        <div class="col-md-3 text-end">
          <button class="btn btn-outline-success" (click)="exportOrders()">
            <i class="bi bi-download"></i> Export
          </button>
        </div>
      </div>

      <!-- Orders Table -->
      <div class="table-responsive">
        <table class="table table-hover table-striped">
          <thead class="table-dark">
            <tr>
              <th>Order ID</th>
              <th>User ID</th>
              <th>Restaurant</th>
              <th>Items</th>
              <th>Total</th>
              <th>Status</th>
              <th>Date</th>
              <th>Actions</th>
            </tr>
          </thead>
          <tbody>
            <tr *ngFor="let order of filteredOrders">
              <td><strong>#{{ order.id }}</strong></td>
              <td>{{ order.userId }}</td>
              <td>{{ getRestaurantName(order.restaurant) }}</td>
              <td>
                <span class="badge bg-secondary">
                  {{ order.menuItemIds?.length || 0 }} items
                </span>
              </td>
              <td><strong>${{ order.totalAmount?.toFixed(2) }}</strong></td>
              <td>
                <span class="badge" [ngClass]="order.status ? getStatusBadgeClass(order.status) : 'bg-secondary'">
                  {{ order.status || 'PENDING' }}
                </span>
              </td>
              <td>{{ order.orderDate | date: 'short' }}</td>
              <td>
                <div class="btn-group" role="group">
                  <button
                    class="btn btn-sm btn-info"
                    (click)="openOrderDetails(order)"
                    title="View Details"
                  >
                    <i class="bi bi-eye"></i>
                  </button>
                  <div class="dropdown">
                    <button
                      class="btn btn-sm btn-warning dropdown-toggle"
                      type="button"
                      data-bs-toggle="dropdown"
                      title="Update Status"
                    >
                      <i class="bi bi-arrow-repeat"></i>
                    </button>
                    <ul class="dropdown-menu">
                      <li *ngFor="let status of orderStatuses">
                        <a
                          class="dropdown-item"
                          (click)="updateOrderStatus(order.id!, status)"
                          [class.active]="order.status === status"
                        >
                          {{ status }}
                        </a>
                      </li>
                    </ul>
                  </div>
                  <button
                    class="btn btn-sm btn-danger"
                    (click)="deleteOrder(order.id!)"
                    title="Delete"
                  >
                    <i class="bi bi-trash"></i>
                  </button>
                </div>
              </td>
            </tr>
            <tr *ngIf="filteredOrders.length === 0">
              <td colspan="8" class="text-center text-muted py-4">
                No orders found
              </td>
            </tr>
          </tbody>
        </table>
      </div>
    </div>
  </div>
</div>

<!-- Order Details Modal -->
<div
  class="modal fade"
  [class.show]="showDetailModal"
  [style.display]="showDetailModal ? 'block' : 'none'"
  tabindex="-1"
  *ngIf="showDetailModal && selectedOrder"
>
  <div class="modal-dialog modal-lg">
    <div class="modal-content">
      <div class="modal-header bg-info text-white">
        <h5 class="modal-title">Order Details - #{{ selectedOrder.id }}</h5>
        <button
          type="button"
          class="btn-close btn-close-white"
          (click)="closeDetailModal()"
        ></button>
      </div>
      <div class="modal-body">
        <div class="row">
          <div class="col-md-6">
            <h6 class="text-muted">Order Information</h6>
            <table class="table table-sm">
              <tr>
                <th>Order ID:</th>
                <td>{{ selectedOrder.id }}</td>
              </tr>
              <tr>
                <th>User ID:</th>
                <td>{{ selectedOrder.userId }}</td>
              </tr>
              <tr>
                <th>Restaurant:</th>
                <td>{{ getRestaurantName(selectedOrder.restaurant) }}</td>
              </tr>
              <tr>
                <th>Order Date:</th>
                <td>{{ selectedOrder.orderDate | date: 'medium' }}</td>
              </tr>
              <tr>
                <th>Status:</th>
                <td>
                  <span
                    class="badge"
                    [ngClass]="selectedOrder.status ? getStatusBadgeClass(selectedOrder.status) : 'bg-secondary'"
                  >
                    {{ selectedOrder.status || 'PENDING' }}
                  </span>
                </td>
              </tr>
            </table>
          </div>
          <div class="col-md-6">
            <h6 class="text-muted">Delivery Information</h6>
            <table class="table table-sm">
              <tr>
                <th>Delivery Address:</th>
                <td>{{ selectedOrder.deliveryAddress || 'N/A' }}</td>
              </tr>
              <tr>
                <th>Notes:</th>
                <td>{{ selectedOrder.notes || 'No notes' }}</td>
              </tr>
              <tr>
                <th>Total Amount:</th>
                <td><strong>${{ selectedOrder.totalAmount?.toFixed(2) }}</strong></td>
              </tr>
            </table>
          </div>
        </div>

        <hr />

        <div class="row">
          <div class="col-md-12">
            <h6 class="text-muted">Order Items</h6>
            <div class="alert alert-info">
              <i class="bi bi-info-circle"></i>
              <strong>{{ selectedOrder.menuItemIds?.length || 0 }}</strong> items in this order
            </div>
            <div class="item-ids">
              <span
                *ngFor="let itemId of selectedOrder.menuItemIds"
                class="badge bg-secondary me-2 mb-2"
              >
                Item #{{ itemId }}
              </span>
            </div>
          </div>
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" (click)="closeDetailModal()">
          Close
        </button>
      </div>
    </div>
  </div>
</div>
<div
  class="modal-backdrop fade"
  [class.show]="showDetailModal"
  *ngIf="showDetailModal"
></div>
